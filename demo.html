<!DOCTYPE html>
<html>
<head></head>
<body>
	<script type="text/javascript" src="./dist/index.js"></script>

	<script type="text/javascript">

		let onVisible = new TillWatch({

			isVisible: function (el) {
				return (el.offsetWidth > 0 || el.offsetHeight > 0);
			},

			condition: function (el) {
				return document.body.contains(el) && this.isVisible(el);
			},

			// timeout: 10000
		});

		window.unverified = new Set();

		let i = 500;

		while (i--) {

			let el = document.createElement('div');

			el.setAttribute('style', 'display: none');

			unverified.add(el);

			let timeout = ~~(Math.random() * 1000);


			let watchEl = onVisible.watch(el);

			watchEl.then(
				function (node) {
					unverified.delete(node);
				},
				function (reason) {
					// console.log(reason);
				}
			);

			setTimeout(function () {

				el.textContent = timeout;

				document.body.appendChild(el);

				// if (~~(Math.random() * 2)) {
					setTimeout(function () {
						el.setAttribute('style', 'display: block');
					}, timeout);
				// }

				if (~~(Math.random() * 2)) {
					onVisible.unwatch(el, watchEl);
				}
			}, timeout);

		}
	</script>
</body>
</html>
